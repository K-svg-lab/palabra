---
globs: ['**/*']
---

# Global Development Principles & Standards

## Core Philosophy
Build a Spanish vocabulary learning application with Apple-level design excellence—minimalist, intuitive, and delightful. Every decision must pass the "Would Steve Jobs and Jony Ive approve?" test.

## Critical Rules (Always Follow)

### Code Quality
- **500 LOC Maximum**: Keep all code files under 500 lines. If exceeded, refactor and split into logical modules
- **Simple & Elegant Solutions**: Favor clarity over cleverness. Code should read like prose
- **Investigate Thoroughly**: Use all available tools (search, grep, codebase exploration) before implementing
- **No Assumptions**: If critical files are missing or requirements unclear, stop and ask/investigate first

### Documentation & Comments
- **Always Comment Your Code**: Every file needs meaningful comments
- **Never Erase Useful Comments**: Preserve context and reasoning from previous work
- **Focus on "Why" and "How"**: Don't state the obvious; explain reasoning and approach
- **JSDoc3 Standard**: Use consistent, well-structured JSDoc3 format for all functions/classes
- Use single-line (`//`) for brief explanations, multi-line (`/* */`) for detailed descriptions

### Research & Context
- **Context7 MCP Required**: Always use Context7 MCP to fetch latest documentation (AI training data is outdated)
- **Check README_PRD.txt**: Reference the PRD regularly to track progress and verify alignment
- **Latest Stable Versions**: Research current stable versions before suggesting frameworks/libraries

### Adaptive Development
- **Rules Evolution**: When project pivots or new features require rule changes, inform user and update rules immediately
- **Progressive Enhancement**: Build mobile-first, then scale up with grace

## Tech Stack (Latest Stable - January 2026)

### Core Framework
- **Next.js 15.x** (App Router): File-based routing, RSC, Server Actions
- **React 19**: Latest stable with improved hooks and concurrent features
- **TypeScript 5.x**: Strict mode enabled for maximum type safety

### Styling & UI
- **Tailwind CSS 4.x**: Utility-first with custom design tokens
- **Framer Motion 11.x**: Fluid animations matching Apple's polish
- **Radix UI / shadcn/ui**: Accessible, composable primitives

### Data & Backend
- **Supabase**: PostgreSQL database, authentication, real-time subscriptions
- **TanStack Query v5**: Server state management, caching, optimistic updates
- **Zustand**: Lightweight client state when needed

### PWA & Performance
- **next-pwa**: Service worker, offline support, installable
- **Sharp**: Image optimization
- **Web Audio API**: Native pronunciation playback

### Quality & Testing
- **Vitest**: Fast unit testing
- **Playwright**: E2E testing
- **ESLint + Prettier**: Code quality and formatting
- **TypeScript strict mode**: Catch errors at compile time

## Project Structure

```
/app                    # Next.js 15 App Router
  /(auth)              # Auth routes group
  /(dashboard)         # Protected dashboard routes
  /api                 # API routes & Server Actions
  /layout.tsx          # Root layout
  /globals.css         # Global styles

/components
  /ui                  # Base UI primitives (shadcn)
  /features            # Feature-specific components
  /layouts             # Layout components
  /shared              # Shared/common components

/lib
  /supabase           # Supabase client & utilities
  /hooks              # Custom React hooks
  /utils              # Helper functions
  /constants          # App constants & config
  /types              # TypeScript types/interfaces

/public               # Static assets
  /audio             # Pronunciation audio files
  /icons             # App icons for PWA

/styles              # Additional styles if needed

/tests               # Test files
  /unit             # Unit tests
  /integration      # Integration tests
  /e2e              # End-to-end tests
```

## Core Principles Hierarchy

1. **User Experience First**: Every technical decision serves UX
2. **Performance**: Fast by default—optimize aggressively
3. **Accessibility**: WCAG 2.1 AA minimum, keyboard navigation everywhere
4. **Security**: Never trust client, validate everything server-side
5. **Maintainability**: Future developers (including you) should understand code instantly
6. **Scalability**: Design for growth without over-engineering now

## Development Workflow

### Before Coding
1. Read/reference README_PRD.txt for requirements
2. Use Context7 MCP to verify latest documentation
3. Search codebase for existing patterns/solutions
4. Plan component structure and data flow

### During Coding
- Write code in small, testable units
- Comment as you code, not after
- Keep files under 500 LOC
- Run linter continuously

### After Coding
- Test manually and with automated tests
- Verify mobile responsiveness
- Check accessibility with keyboard navigation
- Review comments for clarity

## Error Handling Philosophy
- **Graceful Degradation**: App works even when features fail
- **User-Friendly Messages**: Technical errors → plain English
- **Logging**: Capture errors for debugging without exposing internals
- **Offline Resilience**: Core features work without connection

## Security Mindset
- Validate all inputs (never trust client)
- Sanitize data before rendering
- Use Supabase RLS (Row Level Security) policies
- Environment variables for secrets (never commit)
- HTTPS only in production
- CSP headers configured

## Performance Targets
- **First Contentful Paint**: < 1.5s
- **Time to Interactive**: < 3.5s on 3G
- **Core Web Vitals**: All green
- **Bundle Size**: Main bundle < 200KB gzipped
- **Lighthouse Score**: 90+ across all categories

## Accessibility Standards
- Semantic HTML always
- ARIA labels where needed
- Keyboard navigation for all interactions
- Focus indicators visible
- Screen reader tested
- Color contrast ratio > 4.5:1

## Git Practices
- Meaningful commit messages
- Small, focused commits
- Feature branches for new work
- Never commit secrets or API keys

## When in Doubt
1. Choose the simpler solution
2. Ask for clarification
3. Check the PRD
4. Research with Context7 MCP
5. Look at Apple's HIG for inspiration
