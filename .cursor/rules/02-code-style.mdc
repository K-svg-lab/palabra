---
globs: ['**/*']
---

# Code Style & Best Practices

## Guiding Principle
Code is read more than written. Optimize for clarity, maintainability, and future developers.

## TypeScript Standards

### Type Discipline
- Strict mode, no `any`, explicit return types
- `interface` for objects, `type` for unions/intersections
- Discriminated unions for variants

### Naming
- Types: PascalCase, Props suffix: ComponentNameProps
- Enums: PascalCase/UPPER_SNAKE_CASE, Generics: Descriptive

## React & Next.js Style

### Component Structure
1. Imports (external → internal → types → styles)
2. Types/Constants
3. Component + Hooks
4. Handlers/Effects
5. Early returns
6. Render/Export

### Naming & Props
- Files: kebab-case, Components: PascalCase, One per file
- Props: Destructure, required first, booleans `is/has/should`, callbacks `on`
- Avoid prop drilling

### Server vs Client
- Default Server unless need interactivity
- Client: Event handlers, hooks, browser APIs
- Mark `'use client'`

## Function Design

### Size & Structure
- Max 50 lines (split if longer)
- Single Responsibility
- Max 3-4 parameters (use options object if more)
- Pure functions preferred
- Guard clauses first (early returns)

### Naming
- Actions: Verbs (fetchVocabulary, calculateNextReview)
- Boolean returns: Prefix `is`, `has`, `should`
- Clear intent from name

### Async Functions
- Always handle errors (try-catch)
- Return meaningful values
- Track loading states
- Use AbortController for cancellation

## Data Handling

### State Updates
- Immutable (never mutate directly)
- Immer for complex nested updates
- Optimistic updates (revert on error)
- State colocation (keep state close to usage)

### Forms
- React Hook Form + Zod
- Schema-driven validation
- Client + Server validation (never skip server)
- Accessible errors

### API Calls
- TanStack Query for fetching
- Server Actions for mutations
- Define expected error shapes

## Styling

### Tailwind CSS
- Utility-first composition
- Extract repeated patterns to components
- Semantic grouping (layout → spacing → typography → colors)
- Responsive mobile-first

### Animation
- Purposeful only
- Spring physics (Framer Motion)
- Transform and opacity only (GPU)
- Respect prefers-reduced-motion

## Error Handling

### Error Boundaries
- Wrap feature areas
- Provide recovery actions
- Log to error tracking

### API Errors
1. Network: Retry option
2. Validation: Field-level feedback
3. Auth: Redirect to login
4. Server: Generic message, log details
5. Offline: Queue, show indicator

### User Messages
- Plain English
- Actionable
- Specific when helpful
- Polite tone

## Commenting

### When to Comment
- Why, not what
- Non-obvious decisions
- Complex algorithms
- Workarounds (link to issue)
- TODOs with date

### JSDoc3 Format
```typescript
/**
 * Brief description
 * @param name - Description
 * @returns Description
 * @throws {ErrorType} When/why
 */
```

## File Organization

### Imports
External → Internal (absolute) → Types → Styles

### Exports
- Named exports preferred
- Default for pages (Next.js convention)
- Barrel exports (index.ts)

## Performance

### React
- Memoize when measured
- useCallback for callbacks to memoized children
- Stable keys for lists
- Lazy load large components

### Bundle
- Tree shake (import specific)
- Analyze periodically
- Code split routes and heavy components

## Accessibility

### Semantic HTML
- Use correct elements (`<button>` not `<div onClick>`)
- Heading hierarchy
- Labels for inputs (`htmlFor`)

### ARIA
- Native elements first
- Labels for icon buttons
- Live regions for dynamic updates
- Expanded/hidden for collapsible

### Keyboard
- All interactive elements focusable
- Logical tab order
- Visible focus indicators

### Color
- WCAG AA minimum (4.5:1)
- Don't rely on color alone
- Support high contrast

## Git

### Commit Messages
`<type>(<scope>): <description>`

Types: feat, fix, docs, style, refactor, test, chore

### Commit Size
- Atomic (one logical change)
- Frequent (working increments)
- Meaningful messages

## Common Pitfalls
- Fetching in useEffect (use TanStack Query)
- Missing dependencies
- Creating objects in render
- Using `any`
- Ignoring errors with `@ts-ignore`
- Premature optimization
- Trusting client input
- Exposing API keys
- Skipping server validation
